{% extends "base.html" %}

{% block title %}Executive Summary - Code Analysis Report{% endblock %}

{% block header_title %}üìä Executive Summary{% endblock %}
{% block header_subtitle %}Code Repository Analysis Report{% endblock %}

{% block content %}
<!-- Key Performance Indicators -->
<div class="mb-12">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6">
        <div class="bg-gradient-to-br from-uog-blue to-uog-sky text-white p-6 rounded-lg text-center print-avoid-break">
            <h3 class="text-3xl font-bold mb-2">{{ summary.successful_analyses }}</h3>
            <p class="text-sm opacity-90">Projects Analyzed</p>
        </div>
        
        <div class="bg-gradient-to-br from-uog-leaf to-green-600 text-white p-6 rounded-lg text-center print-avoid-break">
            <h3 class="text-3xl font-bold mb-2">{{ summary.unique_dependency_count | default(summary.total_dependencies) }}</h3>
            <p class="text-sm opacity-90">Unique Dependencies</p>
            {% if summary.unique_dependency_count != summary.total_dependencies %}
            <p class="text-xs opacity-75">({{ summary.total_dependencies }} total usages)</p>
            {% endif %}
        </div>
        
        <div class="bg-gradient-to-br from-{% if risk_metrics.vulnerable_projects > 0 %}uog-burgundy to-red-700{% else %}uog-leaf to-green-600{% endif %} text-white p-6 rounded-lg text-center print-avoid-break">
            <h3 class="text-3xl font-bold mb-2">{{ risk_metrics.vulnerable_projects }}</h3>
            <p class="text-sm opacity-90">Projects with Vulnerabilities</p>
        </div>
        
        <div class="bg-gradient-to-br from-uog-rust to-orange-600 text-white p-6 rounded-lg text-center print-avoid-break">
            <h3 class="text-3xl font-bold mb-2">{{ risk_metrics.risk_score }}%</h3>
            <p class="text-sm opacity-90">Security Risk Score</p>
        </div>
        
        <div class="bg-gradient-to-br from-{% if summary.sentry_metrics.projects_with_errors > 0 %}uog-rust to-orange-600{% else %}uog-leaf to-green-600{% endif %} text-white p-6 rounded-lg text-center print-avoid-break">
            <h3 class="text-3xl font-bold mb-2">{{ summary.sentry_metrics.projects_with_sentry }}</h3>
            <p class="text-sm opacity-90">Projects with Sentry</p>
        </div>
        
        <div class="bg-gradient-to-br from-{% if summary.sentry_metrics.total_sentry_issues > 0 %}uog-burgundy to-red-700{% else %}uog-leaf to-green-600{% endif %} text-white p-6 rounded-lg text-center print-avoid-break">
            <h3 class="text-3xl font-bold mb-2">{{ summary.sentry_metrics.total_sentry_issues }}</h3>
            <p class="text-sm opacity-90">Sentry Issues (30d)</p>
        </div>
    </div>
</div>

<!-- Executive Analysis -->
<div class="bg-gradient-to-r from-uog-light-slate to-gray-50 p-8 rounded-xl border-l-4 border-uog-blue mb-12 print-avoid-break">
    <h2 class="text-2xl font-bold text-uog-slate mb-6 flex items-center">
        <span class="mr-3">üìã</span>
        Executive Analysis
    </h2>
    
    {% if llm_summary %}
        <div class="prose prose-lg max-w-none text-gray-700 leading-relaxed">
            {{ llm_summary | markdown | safe }}
        </div>
    {% else %}
        <div class="space-y-4 text-gray-700">
            <p class="text-lg">
                This report analyzes <span class="font-semibold text-uog-blue">{{ summary.successful_analyses }} software projects</span> 
                across multiple programming languages and frameworks. The analysis covers code quality, security vulnerabilities, 
                dependency management, and development activity metrics.
            </p>
            
            {% if risk_metrics.vulnerable_projects > 0 %}
                <div class="bg-red-50 border-l-4 border-uog-burgundy p-4 rounded-r-lg">
                    <p class="font-semibold text-uog-burgundy">‚ö†Ô∏è Security Alert:</p>
                    <p>{{ risk_metrics.vulnerable_projects }} out of {{ summary.successful_analyses }} projects have known security vulnerabilities, representing a {{ risk_metrics.risk_score }}% risk exposure. Immediate attention is recommended for vulnerable projects.</p>
                </div>
            {% else %}
                <div class="bg-green-50 border-l-4 border-uog-leaf p-4 rounded-r-lg">
                    <p class="font-semibold text-uog-leaf">‚úÖ Security Status:</p>
                    <p>All analyzed projects show clean security profiles with no known vulnerabilities detected.</p>
                </div>
            {% endif %}

            <p><span class="font-semibold text-uog-blue">Technology Stack:</span> The portfolio spans {{ summary.languages|length }} primary programming languages with {{ summary.frameworks|length }} different frameworks in use.</p>
            
            <p><span class="font-semibold text-uog-blue">Development Activity:</span> Across all projects, there have been {{ summary.activity_metrics.total_commits }} commits in the past month by {{ summary.activity_metrics.total_contributors }} unique contributors, indicating {{ "active" if summary.activity_metrics.total_commits > 10 else "moderate" }} development activity.</p>
            
            {% if summary.sentry_metrics.projects_with_sentry > 0 %}
                <p><span class="font-semibold text-uog-blue">Error Monitoring:</span> {{ summary.sentry_metrics.projects_with_sentry }} out of {{ summary.successful_analyses }} projects have Sentry error tracking configured. 
                {% if summary.sentry_metrics.total_sentry_issues > 0 %}
                    There were {{ summary.sentry_metrics.total_sentry_issues }} total issues in the past month, with {{ summary.sentry_metrics.total_sentry_resolved }} resolved.
                    {% if summary.sentry_metrics.avg_resolution_time > 0 %}
                        Average resolution time is {{ "%.1f"|format(summary.sentry_metrics.avg_resolution_time) }} days.
                    {% endif %}
                {% else %}
                    No error issues detected in the past month, indicating stable production environments.
                {% endif %}
                </p>
            {% else %}
                <div class="bg-orange-50 border-l-4 border-uog-rust p-4 rounded-r-lg">
                    <p class="font-semibold text-uog-rust">‚ö†Ô∏è Error Monitoring:</p>
                    <p>No projects have Sentry error tracking configured. Consider implementing error monitoring for better production visibility.</p>
                </div>
            {% endif %}
        </div>
    {% endif %}
</div>

<!-- Analytics Charts -->
{% if charts %}
<div class="mb-12">
    <h2 class="text-3xl font-bold text-uog-slate mb-8 border-l-4 border-uog-blue pl-4">
        üìà Analytics Overview
    </h2>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        {% if charts.language_distribution %}
        <div class="bg-white p-6 rounded-xl shadow-md print-avoid-break">
            <h3 class="text-xl font-semibold text-uog-slate mb-4 border-b pb-2">Primary Languages Distribution</h3>
            <div class="min-h-[400px]">
                {{ charts.language_distribution | safe }}
            </div>
        </div>
        {% endif %}
        
        {% if charts.security_overview %}
        <div class="bg-white p-6 rounded-xl shadow-md print-avoid-break">
            <h3 class="text-xl font-semibold text-uog-slate mb-4 border-b pb-2">Security Overview</h3>
            <div class="min-h-[400px]">
                {{ charts.security_overview | safe }}
            </div>
        </div>
        {% endif %}
        
        {% if charts.activity_metrics %}
        <div class="bg-white p-6 rounded-xl shadow-md print-avoid-break">
            <h3 class="text-xl font-semibold text-uog-slate mb-4 border-b pb-2">Issue Resolution Performance</h3>
            <div class="min-h-[400px]">
                {{ charts.activity_metrics | safe }}
            </div>
        </div>
        {% endif %}
        
        {% if charts.dependency_license_distribution %}
        <div class="bg-white p-6 rounded-xl shadow-md print-avoid-break">
            <h3 class="text-xl font-semibold text-uog-slate mb-4 border-b pb-2">Dependency License Distribution</h3>
            <div class="min-h-[400px]">
                {{ charts.dependency_license_distribution | safe }}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

<!-- Project Details -->
<div class="mb-12">
    <h2 class="text-3xl font-bold text-uog-slate mb-8 border-l-4 border-uog-blue pl-4">
        üìÅ Project Details
    </h2>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
        {% for project in projects %}
        <div class="bg-gradient-to-br from-white to-gray-50 p-6 rounded-xl shadow-md border-l-4 {% if project.vulnerability_summary.vulnerable_packages > 0 %}border-uog-burgundy{% else %}border-uog-blue{% endif %} print-avoid-break">
            <h4 class="text-lg font-semibold text-uog-slate mb-3">{{ project.name }}</h4>
            
            <div class="space-y-2 text-sm">
                <p><span class="font-medium text-uog-blue">Language:</span> {{ project.primary_language | title }}</p>
                <p><span class="font-medium text-uog-blue">Dependencies:</span> {{ project.vulnerability_summary.total_dependencies | default(0) }}</p>
                <p><span class="font-medium text-uog-blue">Stars:</span> {{ project.github_metadata.stars | default(0) }}</p>
            </div>
            
            <div class="mt-4">
                {% if project.vulnerability_summary.vulnerable_packages > 0 %}
                    <span class="inline-block px-3 py-1 bg-red-100 text-uog-burgundy text-xs font-medium rounded-full">
                        {{ project.vulnerability_summary.vulnerable_packages }} vulnerabilities
                    </span>
                {% else %}
                    <span class="inline-block px-3 py-1 bg-green-100 text-uog-leaf text-xs font-medium rounded-full">
                        Secure
                    </span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Recommendations -->
{% if risk_metrics.vulnerable_projects > 0 %}
<div class="bg-gradient-to-r from-orange-50 to-red-50 border border-uog-rust rounded-xl p-8 mb-12 print-avoid-break">
    <h3 class="text-2xl font-bold text-uog-rust mb-6 flex items-center">
        <span class="mr-3">üîß</span>
        Recommended Actions
    </h3>
    
    <div class="space-y-4">
        <div class="flex items-start space-x-3">
            <div class="flex-shrink-0 w-6 h-6 bg-uog-burgundy text-white rounded-full flex items-center justify-center text-xs font-bold">1</div>
            <div>
                <p class="font-semibold text-uog-rust">Immediate Action Required</p>
                <p class="text-gray-700">Review and update vulnerable dependencies in {{ risk_metrics.vulnerable_projects }} affected project{{ 's' if risk_metrics.vulnerable_projects > 1 else '' }}</p>
            </div>
        </div>
        
        <div class="flex items-start space-x-3">
            <div class="flex-shrink-0 w-6 h-6 bg-uog-rust text-white rounded-full flex items-center justify-center text-xs font-bold">2</div>
            <div>
                <p class="font-semibold text-uog-rust">Short-term Strategy</p>
                <p class="text-gray-700">Implement automated dependency scanning in CI/CD pipelines</p>
            </div>
        </div>
        
        <div class="flex items-start space-x-3">
            <div class="flex-shrink-0 w-6 h-6 bg-uog-rust text-white rounded-full flex items-center justify-center text-xs font-bold">3</div>
            <div>
                <p class="font-semibold text-uog-rust">Long-term Planning</p>
                <p class="text-gray-700">Establish regular security review processes and dependency update schedules</p>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block footer_content %}
This report was automatically generated by Code Reporter. For detailed project analysis, refer to individual project reports.
{% endblock %}